Added null checks and synchronizations.